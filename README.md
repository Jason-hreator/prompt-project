# 提示精灵 - AI提示词社区

## 项目简介

提示精灵是一个用于分享、发现和管理AI提示词的平台，帮助用户更有效地使用各种AI模型，如ChatGPT、Claude、Midjourney等。用户可以浏览、搜索、收藏提示词，也可以提交自己的提示词分享给社区。

## 技术栈

- 前端：Next.js 14+ (App Router), React, TailwindCSS
- 后端：Next.js API Routes
- 数据库：Supabase (PostgreSQL)
- 鉴权：JWT + Supabase Auth

## 主要功能

- 提示词浏览与搜索
- 按分类、模型筛选提示词
- 用户注册与邮箱验证
- 用户登录与会话管理
- 提示词提交与审核系统
- 点赞与评论功能
- 个人提示词管理
- 管理员审核界面

## 部署说明

### 环境要求

- Node.js 18+
- npm 或 yarn

### 安装与启动

1. 克隆仓库
```bash
git clone <repository-url>
cd prompt-sharing-website
```

2. 安装依赖
```bash
npm install
# 或
yarn
```

3. 配置环境变量
创建 `.env.local` 文件，添加以下内容：
```
NEXT_PUBLIC_SUPABASE_URL=你的Supabase项目URL
NEXT_PUBLIC_SUPABASE_ANON_KEY=你的Supabase公共密钥
JWT_SECRET=你的JWT密钥
NEXT_PUBLIC_SITE_URL=你的网站URL(生产环境)
```

4. 启动开发服务器
```bash
npm run dev
# 或
yarn dev
```

## 最新更新说明

### 1. 深色主题设计

项目UI已完全更新为深色主题，主要更改包括：

- 整体配色方案从浅色改为深色，更适合长时间使用
- 采用蓝色/紫色为主要强调色
- 优化了卡片、按钮、输入框等组件样式
- 添加了全局CSS变量和通用样式类
- 改进了动画和过渡效果
- 优化了滚动条和页面过渡效果

### 2. 用户认证系统改进

彻底重构了用户认证系统，增强了安全性和用户体验：

- **注册功能**
  - 完全适配深色主题，提供一致的视觉体验
  - 邮箱格式验证和密码强度检查
  - 添加了邮箱验证功能
  - 开发环境支持跳过邮箱验证
  - 更详细的错误提示和表单验证

- **登录功能**
  - 支持测试账号快速登录（仅开发环境）
  - 改进了错误处理和提示消息
  - 添加JWT验证和用户会话管理
  - 统一的认证流程和响应格式
  
- **密码恢复功能**
  - 添加了"忘记密码"页面
  - 实现了密码重置邮件发送功能
  - 添加了密码重置页面
  - 完整支持Supabase Auth密码重置流程
  - 适配深色主题设计
  - 表单验证和状态反馈

- **认证状态管理**
  - 实现了AuthContext全局状态管理
  - 提供useAuth钩子函数简化认证状态访问
  - 支持本地存储用户信息和令牌
  - 自动恢复登录状态

### 3. 组件化改进

- **重构了Header和Footer组件**
  - 响应式设计，适应各种屏幕尺寸
  - 用户登录状态感知
  - 管理员特定功能访问

- **表单组件统一样式**
  - 表单验证和错误提示
  - 加载状态显示
  - 表单按钮禁用逻辑

- **FeaturedPrompts组件优化**
  - 完全移除对本地硬编码数据的依赖
  - 使用API接口动态获取热门提示词
  - 改进了错误处理和空数据状态显示
  - 添加重试功能和用户友好提示
  - 优化了加载状态和卡片样式

## 数据库迁移和Bug修复说明

### 从本地JSON文件迁移到Supabase数据库

本项目最初使用本地JSON文件存储数据，现已完成迁移到Supabase数据库，主要修改包括：

1. 创建Supabase客户端连接
2. 修改所有API路由，使用Supabase API替代本地文件读写
3. 调整数据结构以匹配Supabase表结构
4. 确保前端组件能够处理新的数据格式

### 关键Bug修复

1. **提示词列表问题**
   - 修复了无法获取提示词列表的问题
   - 添加了对API响应格式的兼容处理（同时支持data和prompts字段）
   - 增强了错误处理以显示更详细的错误信息

2. **提示词详情页面问题**
   - 解决了作者信息渲染错误（将对象直接渲染为字符串的问题）
   - 改进了author字段的处理逻辑，确保在不同数据格式下能正确显示作者信息
   - 修复了评论计数和显示问题

3. **API路由优化**
   - 增强了错误处理和日志记录
   - 修复了404错误
   - 统一了API响应格式

4. **分类功能改进**
   - 确保在没有分类数据时使用默认分类
   - 添加分类图标和计数功能

5. **认证系统问题**
   - 添加忘记密码功能和密码重置功能
   - 修复了登录失败时的错误提示问题
   - 解决了无法注册新用户的bug
   - 添加了邮箱验证功能
   - 统一了所有认证页面的深色主题风格

3. **FeaturedPrompts组件问题**
   - 修复了依赖本地模拟数据的问题
   - 改进了API请求逻辑，确保只使用实际数据库数据
   - 优化了错误处理，使其在API故障时仍能优雅降级
   - 提供更好的用户反馈和重试功能

## 表结构参考

Supabase数据库包含以下表：

1. **users** - 用户信息
   - id, name, email, role, avatar_url, created_at

2. **prompts** - 提示词数据
   - id, title, content, description, category_id, model, user_id, is_featured, created_at, views, likes

3. **categories** - 提示词分类
   - id, name, description, icon

4. **comments** - 评论数据
   - id, prompt_id, user_id, content, created_at

5. **likes** - 点赞数据
   - user_id, prompt_id, created_at

## 开发注意事项

1. 使用Supabase API时，确保正确处理行级安全策略
2. 修改API时，保持响应格式一致性
3. 使用控制台日志记录关键操作和错误，便于调试
4. 确保正确处理各种数据边界情况（null, undefined, 空数组等）
5. 开发环境中使用测试账号：
   - 管理员: admin@example.com / password
   - 普通用户: user@example.com / password

## 常见问题解决

- **数据不显示问题**: 检查API响应格式，确保前端能处理data或prompts字段
- **作者显示错误**: 确保正确处理author字段（可能是字符串或对象）
- **Windows PowerShell使用提示**: PowerShell中不支持&&连接命令，请使用分号或单独执行命令

6. **最新修复说明**

- **Supabase连接修复**
  - 更新了Supabase URL和密钥配置
  - 修复了数据库连接失败和身份验证错误
  - 解决了"获取提示词发生错误"的500错误

- **深色主题优化**
  - 完善了所有下拉菜单的深色主题配色
  - 统一了表单控件、按钮和提示信息的样式
  - 改进了分页按钮和筛选器组件的深色样式
  - 修复了部分组件在深色背景下的可读性问题

- **分类功能改进**
  - 添加了从API动态获取分类数据的功能
  - 提供了默认分类数据作为备选，避免无数据状态
  - 改进了分类加载和错误处理逻辑
  - 优化了分类选择器的用户体验

- **登录和注册功能修复**
  - 完善了登录错误提示，更加明确具体原因
  - 修复了管理员账号登录问题
  - 改进了注册流程和邮箱验证功能
  - 增强了错误处理和网络连接问题提示
  - 优化了测试账号登录功能，便于开发测试

7. **常见问题与解决方案**

- **数据库连接问题**: 
  - 确保环境变量中配置了正确的Supabase URL和密钥
  - 检查网络连接，确保可以访问Supabase服务
  - 在开发中遇到连接问题时，会自动使用默认数据

- **邮箱验证失败**: 
  - 开发环境下可跳过邮箱验证
  - 确保配置了正确的重定向URL
  - 测试账号可直接登录无需验证

- **Windows PowerShell命令使用**:
  - 在PowerShell中使用分号`;`替代`&&`连接命令
  - 例如：`cd prompt-sharing-website; npm run dev`
